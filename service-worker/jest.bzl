"Shows how you might create a macro for the autogenerated Jest rule"

load("@sw_npm//jest-cli:index.bzl", _jest_test = "jest_test")

def jest_test(name, srcs, deps, jest_config, **kwargs):
    """A macro around the autogenerated jest_test rule.

    Args:
      name: the name of the test target
      srcs: files with the jest tests
      deps: additional dependencies
      jest_config: the jest configuration file
      **kwargs: additional arguments to pass to the generated nodejs_test target
    """
    templated_args = [
        "--no-cache",
        "--no-watchman",
        "--ci",
        "--colors",
    ]
    templated_args.extend(["--config", "$(rootpath %s)" % jest_config])
    for src in srcs:
        templated_args.extend(["--runTestsByPath", "$(rootpath %s)" % src])

    data = [jest_config] + srcs + deps
    _jest_test(
        name = name,
        data = data,
        templated_args = templated_args,
        **kwargs
    )
